function updateItem(){var n={id:id,parent:navigationItem!==undefined?navigationItem.parent:0,navigationId:$("#id").val(),linkedToType:$("#linkTo").val(),filterAlternateGuid:$("#section select#select").data("select2")?$("#section select#select").val()!==null?$("#section select#select").val():"0":"0",linkedToAlternateGuid:$("#page select#pageSelect").data("select2")?$("#page select#pageSelect").val():"",name:$("#name").val(),target:$("#linkTo").val()!=="nothing"?$("#target").val():"",customUrl:$("#url").val(),customOrder:navigationItem!==undefined?navigationItem.customOrder:0};$.ajax({url:"/spine-api/navigation/item/update",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(n),success:function(n){return response=n.value,toastr[response.messageType](response.message),getList(),$("#modalItem").modal("hide"),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function createSelectOptions(n,t,i,r){var u=$("#page").find("label#heading").html(n).parents("#page").find("select#pageSelect").select2({allowClear:!0,placeholder:{id:"0",text:i,value:"",selected:"selected"},data:t}).val(r).trigger("change").parents("#page").fadeIn(500).find("select#pageSelect").rules("add",{required:!0,messages:{required:selectOption}})}function createSectionOptions(n,t,i,r){if(t.length!==0)var u=$("#section").find("label#heading").html(n).parents("#section").find("select#select").select2({allowClear:!0,placeholder:{id:"0",text:i,value:"",selected:"selected"},data:t}).val(r).trigger("change").parents("#section").fadeIn(500)}function generateList(n){$("#navigationItems").empty();n.data.length>1&&$("#saveOrder").removeClass("hidden");$.each(n.data,function(t,i){i.parent===0&&($("#cloneListObject").clone().appendTo("#navigationItems"),$("#navigationItems").find("#cloneListObject").removeClass("hidden").data("id",i.id).attr("id","n"+i.id),$("#n"+i.id).find("#navigationItemName a").html(i.name),createChilds(n.data,t,i))});$(".dd-item a").off().on("click",function(){id=$(this).parents("li").data("id");$("#modalItem h4").html(editLink);$("#create").html(editLink);$("#closeHolder").addClass("col-sm-4").removeClass("col-sm-6");$("#createHolder").addClass("col-sm-4").removeClass("col-sm-6");$("#deleteHolder").removeClass("hidden");getItem()});$("#nestable").nestable({maxDepth:n.maxDepth,dragClass:"dd-dragel dd-pages",itemNodeName:"li.dd-item",handleClass:"dd3-handle"});$("#nestable li").on("mousedown touchstart",function(){$(this).attr("data-changed",!0)});return $("#main-wrapper").fadeIn(500),!0}function getItem(){var n={id:id};$.ajax({url:"/spine-api/navigation/item",dataType:"json",type:"get",data:n,contentType:"application/json;",success:function(n){var t=n.value;resetModalFields();$("#modalItem").modal("show");navigationItem=t;$("#name").val(navigationItem.name);$("#linkTo").val(navigationItem.linkedToType.toLowerCase());sectionVal=navigationItem.filterAlternateGuid!==""?navigationItem.linkedToSectionId+":"+navigationItem.filterAlternateGuid:navigationItem.linkedToSectionId;switch(navigationItem.linkedToType.toLowerCase()){case"page":showTarget();getPages(navigationItem.linkedToAlternateGuid,"page",page,pleaseSelectPage);break;case"category":showTarget();getPages(navigationItem.linkedToAlternateGuid,"eCommerceCategory",category,pleaseSelectCategory);break;case"dataitem":showTarget();getDataItems(navigationItem.linkedToAlternateGuid);break;case"product":showTarget();getProducts(navigationItem.linkedToAlternateGuid);break;case"external":showTarget();fillExternal(navigationItem.customUrl);break;default:hideTarget()}return $("#target").val(navigationItem.target.toLowerCase()),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}var id=0,validateForm,sectionVal,navigationItem;$(document).ready(function(){$("#navigation #navNavi"+$("#id").val()).addClass("active").parents("li").addClass("active").addClass("open").find(".sub-menu").slideDown();getList();validateForm=$("#form").validate({ignore:[],errorPlacement:function(n,t){t.parent(".input-group").length&&n.insertAfter(t.parent());t.hasClass("select2-hidden-accessible")?n.appendTo(t.parent()):n.insertAfter(t)},rules:{name:{required:!0,maxlength:100},linkTo:{required:!0}},messages:{name:{required:enterName},linkTo:{required:selectWhichType}},onkeyup:function(n){$(n).valid()}});$("#saveOrder").on("click",function(){var n=getListItems();n.length!==0&&$.ajax({url:"/spine-api/navigation/items/update",dataType:"json",type:"post",data:JSON.stringify(n),contentType:"application/json;",success:function(n){var t=n.value;return toastr[t.messageType](t.message),$.each($("#nestable li"),function(){$(this).attr("data-changed",!1)}),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})});$("#addLink").on("click",function(){id=0;sectionVal=0;resetModalFields();$("#modalItem h4").html(addLink);$("#create").html(addLink);$("#closeHolder").removeClass("col-sm-4").addClass("col-sm-6");$("#createHolder").removeClass("col-sm-4").addClass("col-sm-6");$("#deleteHolder").addClass("hidden");$("#modalItem").modal("show")});$("#delete").on("click",function(){deleteItem()});$("#create").on("click",function(){var n=$("#form").valid();n?updateItem():validateForm.focusInvalid()});$("#page select#pageSelect").on("change",function(){getSections(sectionVal);$("#page select#pageSelect").valid()});$("#linkTo").on("change",function(){switch($(this).val().toLowerCase()){case"page":hideExternal();hideSelect();hideSelectSection();showTarget();getPages("","page",page,pleaseSelectPage);break;case"category":hideExternal();hideSelect();hideSelectSection();showTarget();getPages("","eCommerceCategory",category,pleaseSelectCategory);break;case"dataitem":hideExternal();hideSelect();hideSelectSection();showTarget();getDataItems();break;case"product":hideExternal();hideSelect();hideSelectSection();showTarget();getProducts();break;case"external":hideSelect();hideSelectSection();showTarget();fillExternal();break;default:hideExternal();hideSelect();hideSelectSection();hideTarget()}});$.fn.modal.Constructor.prototype.enforceFocus=$.noop});getPages=function(n,t,i,r){$.ajax({url:"/spine-api/page-options",dataType:"json",type:"get",data:{type:t},contentType:"application/json;",success:function(t){var u=t.value;return createSelectOptions(i,u.results,r,n),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})};getSections=function(n){var t="/spine-api/page/template/sections/get/options",i;if($("#linkTo").val()==="detailPage")t="/spine-api/data/template/sections/get/options";else if($("#linkTo").val()!=="page")return;i={alternateGuid:$("#page select#pageSelect").val()};$.ajax({url:t,dataType:"json",type:"get",data:i,contentType:"application/json;",success:function(t){var i=t.value;return hideSelectSection(),createSectionOptions(goToSectionFilterOn,i.data,pleaseSelectSectionFilter,n),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})};getDataItems=function(n){$.ajax({url:"/spine-api/data/get/options",dataType:"json",type:"get",contentType:"application/json;",success:function(t){var i=t.value;return createSelectOptions(detailPage,i.data,pleaseSelectDetailPage,n),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})};getProducts=function(n){$.ajax({url:"/spine-api/product-options",dataType:"json",type:"get",contentType:"application/json;",success:function(t){var i=t.value;return createSelectOptions(product,i,pleaseSelectProduct,n),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})};createChilds=function(n,t,i){var r=getObjects(n,"parent",i.id);return r.length!==0&&($("#cloneHeadListObject").clone().appendTo("#n"+i.id),$("#navigationItems").find("#cloneHeadListObject").removeClass("hidden").attr("id","navItemHead"+i.id),$.each(r,function(t,i){$("#cloneListObject").clone().appendTo("#navItemHead"+i.parent);$("#navigationItems").find("#cloneListObject").removeClass("hidden").data("id",i.id).attr("id","n"+i.id);$("#n"+i.id).find("#navigationItemName a").html(i.name);createChilds(n,t,i)})),!0};getObjects=function(n,t,i){var r=[];for(var u in n)n.hasOwnProperty(u)&&(typeof n[u]=="object"?r=r.concat(getObjects(n[u],t,i)):u===t&&n[t]===i&&r.push(n));return r};getListItems=function(){jsonObj=[];var n=0;return $('#nestable li[data-changed="true"]').length!==0&&$("#nestable li").each(function(){item={};item.id=$(this).data("id");item.customOrder=++n;item.parent=$(this).parents("li").length===0?0:$(this).parents("li").data("id");jsonObj.push(item)}),jsonObj};resetModalFields=function(){$("#name").val("");hideExternal();hideSelect();hideSelectSection();resetLinkTo();resetTarget();validateForm.resetForm()};hideExternal=function(){$("#external").hide().find("input").val("");jQuery.isEmptyObject($("#external #url").rules())||$("#external #url").rules("remove")};hideSelect=function(){$("#page select#pageSelect").data("select2")?$("#page").hide().find("select#pageSelect").html("").select2("destroy"):$("#page").hide();jQuery.isEmptyObject($("#page select#pageSelect").rules())||$("#page select#pageSelect").rules("remove")};hideSelectSection=function(){$("#section select#select").data("select2")?$("#section").hide().find("select#select").html("").select2("destroy"):$("#section").css("display")!=="none"&&$("#section").hide()};hideTarget=function(){$("#loadIn").css("display")!=="none"&&$("#loadIn").hide();jQuery.isEmptyObject($("#loadIn #target").rules())||$("#loadIn #target").rules("remove")};showTarget=function(){$("#loadIn").css("display")==="none"&&$("#loadIn").fadeIn(500);jQuery.isEmptyObject($("#loadIn #target").rules())&&$("#loadIn #target").rules("add",{required:!0,messages:{required:selectTarget},maxlength:500});validateForm.resetForm()};fillExternal=function(n){$("#external").fadeIn(500).find("input").val(n).rules("add",{required:!0,messages:{required:enterUrl},maxlength:500});validateForm.resetForm()};resetLinkTo=function(){$("#linkTo>option:eq(0)").prop("selected",!0)};resetTarget=function(){hideTarget();$("#target>option:eq(0)").prop("selected",!0)};getList=function(){var n={id:$("#id").val()};$.ajax({url:"/spine-api/navigation",dataType:"json",type:"get",data:n,contentType:"application/json;",success:function(n){var t=n.value;return $("#title").html(t.name),setOptions(t.linkToOptions),generateList(t),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})};deleteItem=function(){data={Id:id};$.ajax({url:"/spine-api/navigation/item/delete",dataType:"json",type:"post",data:data,success:function(n){var t=n.value;return toastr[t.messageType](t.message),getList(),$("#modalDelete").modal("hide"),$("#modalItem").modal("hide"),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})};setOptions=function(n){$("#linkTo").empty();$("#linkTo").append($("<option>",{value:"",text:selectOption}));$.each(n,function(n,t){$("#linkTo").append($("<option>",{value:t.value,text:t.text}))})};