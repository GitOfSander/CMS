function createList(n){n.data.length>1&&$("#saveOrder").removeClass("hidden");$.each(n.data,function(t,i){i.parent===0&&(i.rootPage?($("#cloneListObject").clone().prependTo("#pages"),$("#pages").find("#cloneListObject").removeClass("hidden").data("id",i.id).attr("id","p"+i.id),$("#p"+i.id).find("#name a").html(i.name).attr("href",(i.type==="page"?"/pages/edit/":"/categories/edit/")+i.id),$("#p"+i.id).find(".dd-handle").removeClass("dd3-handle").addClass("dd-root-handle").addClass("fa").addClass("fa-home"),$("#p"+i.id).removeClass("dd-item").removeClass("dd3-item")):($("#cloneListObject").clone().appendTo("#pages"),$("#pages").find("#cloneListObject").removeClass("hidden").data("id",i.id).attr("id","p"+i.id),$("#p"+i.id).find("#name a").html(i.name).attr("href",(i.type==="page"?"/pages/edit/":"/categories/edit/")+i.id),createPageChild(n.data,t,i)))});$("#nestable").nestable({maxDepth:n.maxDepth,dragClass:"dd-dragel dd-pages",itemNodeName:"li.dd-item",handleClass:"dd3-handle"});$("#nestable li").on("mousedown touchstart",function(){$(this).data("changed",!0)});return $("#main-wrapper").fadeIn(500),!0}function createPageChild(n,t,i){var r=getObjects(n,"parent",i.id);return r.length!==0&&($("#cloneHeadListObject").clone().appendTo("#p"+i.id),$("#pages").find("#cloneHeadListObject").removeClass("hidden").attr("id","pageHead"+i.id),$.each(r,function(t,i){$("#cloneListObject").clone().appendTo("#pageHead"+i.parent);$("#pages").find("#cloneListObject").removeClass("hidden").data("id",i.id).attr("id","p"+i.id);$("#p"+i.id).find("#name a").html(i.name).attr("href",$("#p"+i.id).find("#name a").attr("href")+i.id);createPageChild(n,t,i)})),!0}function getObjects(n,t,i){var r=[];for(var u in n)n.hasOwnProperty(u)&&(typeof n[u]=="object"?r=r.concat(getObjects(n[u],t,i)):u===t&&n[t]===i&&r.push(n));return r}function getChangedListItems(){return jsonObj=[],$("#nestable li").each(function(){$(this).data("changed")&&(item={},item.Id=$(this).data("id"),item.Parent=$(this).parents("li").length===0?0:$(this).parents("li").data("id"),jsonObj.push(item))}),jsonObj}$(document).ready(function(){$("#navigation #navBreadcrumbs").addClass("active").parents("li").addClass("active").addClass("open").find(".sub-menu").slideDown();$.ajax({url:"/spine-api/pages",dataType:"json",type:"get",contentType:"application/json;",success:function(n){var t=n.value;return createList(t),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}});$("#saveOrder").on("click",function(){var n=getChangedListItems();n.length!==0&&$.ajax({url:"/spine-api/pages/update",dataType:"json",type:"post",data:JSON.stringify(n),contentType:"application/json;",success:function(n){return toastr[n.messageType](n.message),n.success==="Valid"&&$.each($("#nestable li"),function(){$(this).data("changed",!1)}),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})})});