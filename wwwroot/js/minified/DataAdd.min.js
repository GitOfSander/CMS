function getDataitem(){data={id:dataItemId,dataTemplateId:dataTemplateId};$.ajax({url:"/spine-api/data/item/get",dataType:"json",type:"post",data:data,success:function(n){var t=toCamel(n.value);return backUpData=t,fillItem(t),$("#url").html(t.url),dataItemId!==0&&$("#rootwizard").bootstrapWizard("enable",2),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function afterCreate(n){$("#saveDataItem").attr("disabled",!0);$("#saveDataItem").html("Save");$("#dataTemplate").attr("disabled",!0);dataItemId=n.item!==null?n.item.id:0;$("#dataTemplateFields").empty();fillFields(n);fillUploads(n.uploads);$("#pageDetails input, #pageDetails textarea, #defaultInputs input:not(.date-picker), #defaultInputs textarea").off().on("change paste keyup",function(){$("#save").attr("disabled",!1);fieldChanged=!0});$("#pageUrl").off().on("keyup input propertychange",function(n){n.keyCode!==37&&n.keyCode!==39&&n.keyCode!==0&&createFriendlyUrl(this,"#pageUrl",".form-group");$("#save").attr("disabled",!1);fieldChanged=!0});backUpData=n;$("#rootwizard").bootstrapWizard("show",wizardGoTo);$("#dataItemActive").prop("checked",n.item!==null?n.item.active:!1);$("#dataItemActive").uniform();$("#dataItemActive").off().on("click",function(){$(this).prop("checked",!$(this).prop("checked"));$("#modalDataStatusAlert").modal("show");activateCheckbox=$("#dataItemActive").prop("checked")===!0?!1:!0})}function fillFields(n){fillPageDetails(n);var t=!1;n.resources.length>0&&$("#dataFields").removeClass("hidden");$.each(n.resources,function(n,i){if($("#cloneObject").clone(!0).appendTo("#dataTemplateFields"),$("#dataTemplateFields").find("#cloneObject").removeClass("hidden").data("id",i.dataTemplateFieldId).data("type",i.type.toLowerCase()).attr("id","dtf"+i.dataTemplateFieldId),i.type.toLowerCase()==="html5editor"){var r=$("#dtf"+i.dataTemplateFieldId).find("#html5Editor").removeClass("hidden").summernote({height:200,toolbar:[["cleaner",["cleaner"]],["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["picture","link","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],cleaner:{notTime:2400,action:"both",newline:"<br>",notStyle:"position:absolute;top:0;left:0;right:0",icon:'<i class="note-icon">Verwijder opmaak<\/i>',keepHtml:!1,keepOnlyTags:["<p>","<br>","<ul>","<li>","<b>","<strong>","<i>","<a>"],keepClasses:!1,badTags:["style","script","applet","embed","noframes","noscript","html","div"],badAttributes:["style","start"]},popover:{image:[["custom",["imageAttributes"]],["imagesize",["imageSize100","imageSize50","imageSize25"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]]],link:[["link",["linkDialogShow","unlink"]]]},lang:"nl-NL",imageAttributes:{imageDialogLayout:"default",icon:'<i class="note-icon-pencil"/>',removeEmpty:!1},displayFields:{imageBasic:!0,imageExtra:!1,linkBasic:!0,linkExtra:!1},callbacks:{onBlur:function(){$("#dtf"+i.dataTemplateFieldId+" #html5Editor").data("changed",!0);fieldChanged=!0;$("#save").attr("disabled",!1)},onChange:function(){$("#dtf"+i.dataTemplateFieldId+" #html5Editor").data("changed",!0);fieldChanged=!0;$("#save").attr("disabled",!1)},onImageUpload:function(n){var t=new FormData;$.each(n,function(n,i){t.append(i.name,i)});$.ajax({url:"/api/image",type:"post",contentType:!1,processData:!1,data:t,success:function(n){return $.each(n,function(n,t){r.summernote("insertImage",t,function(){})}),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}}});r.summernote("code",i.text);$("#dtf"+i.dataTemplateFieldId+" #html5Editor").data("changed",!1);fieldChanged=!1;$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading)}else if(i.type.toLowerCase()==="text"||i.type==="number"||i.type==="email"||i.type==="tel")$("#dtf"+i.dataTemplateFieldId).find("input#input").removeClass("hidden").attr("type",i.Type).val(i.text),$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading);else if(i.type.toLowerCase()==="textarea")$("#dtf"+i.dataTemplateFieldId).find("textarea#textarea").removeClass("hidden").val(i.text),$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading);else if(i.type.toLowerCase()==="textarea")$("#dtf"+i.dataTemplateFieldId).find("input#rgba").removeClass("hidden").val(i.text),$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading);else if(i.type.toLowerCase()==="checkbox")$("#dtf"+i.dataTemplateFieldId).find("#checkbox").removeClass("hidden").find("input").prop("checked",i.text.toString().toLowerCase()==="true"?!0:!1).uniform(),$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading);else if(i.type.toLowerCase()==="rgba")t=!0,$("#dtf"+i.dataTemplateFieldId).find("input#rgba").removeClass("hidden").val(i.text),$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading);else if(i.type.toLowerCase()==="selectlinkedto"){$("#dtf"+i.dataTemplateFieldId).find("select#select").removeClass("hidden").select2({multiple:!0,placeholder:"Select "+i.heading.toLowerCase()+"...",data:i.data}).val(i.text).trigger("change").on("change",function(){$("#save").attr("disabled",!1);$(this).data("changed",!0);fieldChanged=!0});$("#dtf"+i.dataTemplateFieldId).find("label#heading").html(i.heading)}$("#dtf"+i.dataTemplateFieldId).find(".hidden").remove()});$("#dataTemplateFields input#input, #dataTemplateFields textarea#textarea").off().on("change paste keyup",function(){$("#save").attr("disabled",!1);$(this).data("changed",!0);fieldChanged=!0});if(t)$("#dataTemplateFields .rgba").off().colorpicker().on("changeColor",function(){$("#save").attr("disabled",!1);$(this).data("changed",!0);fieldChanged=!0});$("#dataTemplateFields #checkbox input").off().change(function(){var n=$(this).prop("checked",$(this).is(":checked"));$.uniform.update(n);$("#save").attr("disabled",!1);$(this).data("changed",!0);fieldChanged=!0});$("#save").attr("disabled",!0);$("#main-wrapper").fadeIn(500)}function fillUploads(n){$("#dataTemplateUploads").empty();dataItemId!==0?n.length>0?$("#rootwizard").bootstrapWizard("enable",1):$("#rootwizard").bootstrapWizard("hide",1):!n.length>0&&$("#rootwizard").bootstrapWizard("hide",1);$.each(n,function(n,t){$("#cloneUploadObject").clone().appendTo("#dataTemplateUploads");$("#dataTemplateUploads").find("#cloneUploadObject").removeClass("hidden").attr("id","dtu"+t.id).attr("data-id",t.id);$("#dtu"+t.id).find("h4").html(t.heading);$("#dtu"+t.id).find("#uploader").attr("id","uploader"+t.id);$(".saveFileOrder").off().on("click",function(){var n=$(this).parents(".dataUploadField").data("id");saveFileOrder(n)});var i=$("#uploader"+t.id).off().pluploadQueue({runtimes:"html5,flash,silverlight,html4",url:"/spine-api/data/item/file",chunk_size:t.maxSize+"mb",rename:!0,dragdrop:!0,multiple_queues:!0,filters:{max_file_size:t.maxSize,mime_types:[{title:"Files",extensions:t.fileExtensions}]},multipart:!0,multipart_params:{width:t.width,height:t.height,autoCrop:!1,dataTemplateUploadId:t.id,dataItemId:dataItemId},flash_swf_url:"~/plugins/plupload/js/Moxie.swf",silverlight_xap_url:"~/plugins/plupload/js/Moxie.xap",init:{BeforeUpload:function(n,t){n.settings.multipart_params.filename=t.name},UploadComplete:function(){fillFiles(dataItemId,t)},FileUploaded:function(n,t,i){var r=$.parseJSON(i.response);toastr[r.value.messageType](r.value.message)},Error:function(n,t){(t.status===401||t.status===403)&&(toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500))}}});$("#uploader"+t.id+" .plupload_add").on("click",function(n){n.preventDefault();var t=document.getElementById(i[0].id+"_html5");t&&!t.disabled&&t.click()});fillFiles(dataItemId,t)});$(".plupload_start").each(function(){$(this).html("Upload")})}function fillFiles(n,t){var i={dataItemId:n,dataTemplateUploadId:t.id};$.ajax({url:"/spine-api/data/item/files",dataType:"json",type:"get",data:i,success:function(i){$("#dtu"+t.id+" .nestable ol").html("");$.each(i.data,function(i,r){var u;$("#cloneListObject").clone().appendTo("#dtu"+r.DataTemplateUploadId+" .nestable ol");$("#dtu"+r.DataTemplateUploadId+" .nestable").find("#cloneListObject").removeClass("hidden").attr("id","dif"+r.Id).attr("data-id",r.Id);u=r.OriginalPath.substr(r.OriginalPath.lastIndexOf(".")+1).toLowerCase();switch(u){case"jpg":case"jpeg":case"png":case"gif":$("#dif"+r.Id).find("img").removeClass("hidden").attr("src",r.CompressedPath+"?lastmod="+new Date);$("#dif"+r.Id+" .image-crop img").attr("src",r.OriginalPath);$("#dif"+r.Id).find("#video").remove();$("#dif"+r.Id).find("#pdf").remove();u!=="png"&&($("#dif"+r.Id).find(".image-crop").addClass("image-crop-bg-black"),$("#dif"+r.Id).find(".img-preview").css("background-color","#000000"));u!=="jpg"&&$("#dif"+r.Id).find(".image-quality").addClass("hidden");$("#dif"+r.Id).find("#qualitySlider").change(function(){$("#dif"+r.Id).find("#quality").html("("+$(this).val()+")")});var f=$("#dif"+r.Id+" .image-crop > img"),e=t.width,o=t.height;$("#dif"+r.Id+" #openCropMdl").on("click",function(){$("#dif"+r.Id+" #imageCropMdl").modal("show");setTimeout(function(){f.cropper({aspectRatio:e/o,preview:"#dif"+r.Id+" .img-preview"})},400)});$("#dif"+r.Id+" #openCropMdl").on("hidden.bs.modal",function(){f.cropper("destroy")});$("#dif"+r.Id+" #crop").on("click",function(){$(".modal").modal("hide")&&f.cropper("getCroppedCanvas").toBlob(function(i){var u=new FormData;u.append("id",r.Id);u.append("type","data");u.append("croppedImage",i);u.append("quality",$("#dif"+r.Id).find("#qualitySlider").val());$.ajax("/spine-api/image/crop",{method:"POST",data:u,processData:!1,contentType:!1,success:function(i){var r=i.value;toastr[r.messageType](r.message);fillFiles(n,t)},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}}})})});break;case"mp4":case"ogv":case"webm":u==="ogv"&&(u="ogg");$("#dif"+r.Id).find("#video").removeClass("hidden").find("source").attr("src",r.OriginalPath+"?lastmod="+new Date).attr("type","video/"+u);$("#dif"+r.Id).find("img").remove();$("#dif"+r.Id).find("#cropHolder").remove();$("#dif"+r.Id).find("#imageCropMdl").remove();$("#dif"+r.Id).find("#pdf").remove();break;case"pdf":$("#dif"+r.Id).find("#pdf").removeClass("hidden").find("a").attr("href",r.OriginalPath);$("#dif"+r.Id).find("img").remove();$("#dif"+r.Id).find("#cropHolder").remove();$("#dif"+r.Id).find("#imageCropMdl").remove();$("#dif"+r.Id).find("#video").remove()}$("#dif"+r.Id).find("#checkbox").find("input").prop("checked",r.Active).uniform();$("#dif"+r.Id).find("#alt").val(r.Alt)});$("#dtu"+t.id+" .nestable").nestable({dragClass:"dd-dragel page-file-dd-item",maxDepth:1});$(".dd-item .active").off().on("click",function(){$(this).prop("checked",!$(this).prop("checked"));$("#modalStatusAlert").modal("show");dataItemFileId=$(this).parents(".dd-item").attr("data-id");activateCheckbox=$(this).prop("checked")===!0?!1:!0});$(".saveAlt").off().on("click",function(){dataItemFileId=$(this).parents("li").data("id");var n=$(this).parents("li").find("input#alt").val();saveFileAlt(dataItemFileId,n)});$(".openDeleteFileModal").off().on("click",function(){dataItemFileId=$(this).parents("li").data("id");$("#modalDeleteFileAlert").modal("show")});return i.data.length>1&&$("#dtu"+t.id+" .saveFileOrder").removeClass("hidden"),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function deleteDataItem(){data={Id:dataItemId};$.ajax({url:"/spine-api/data/item/delete",dataType:"json",type:"post",data:data,success:function(n){var t=n.value;return toastr[t.messageType](t.message),location.href="/data/"+dataTemplateId,!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function deleteFile(n){data={Id:n};$.ajax({url:"/spine-api/data/item/file/delete",dataType:"json",type:"post",data:data,success:function(t){if(toastr[t.messageType](t.message),t.success==="Valid"){$("#modalDeleteFileAlert").modal("hide");var i=$('.nestable li[data-id="'+n+'"]').parents(".dataUploadField").data("id");$('.nestable li[data-id="'+n+'"]').remove();$("#dtu"+i+" ol > li").length<2&&$("#dtu"+i).find(".saveFileOrder").addClass("hidden")}return!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function saveFileStatus(n){var t={id:n,active:activateCheckbox};$.ajax({url:"/spine-api/data/item/file/active",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(t),success:function(t){var i=t.value,r;return toastr[i.messageType](i.message),r=$("#dif"+n).find("#active").prop("checked",activateCheckbox),$.uniform.update(r),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}});$("#modalStatusAlert").modal("hide")}function saveFileAlt(n,t){var i={id:n,alt:t};$.ajax({url:"/spine-api/data/item/file/alt",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(i),success:function(n){var t=n.value;return toastr[t.messageType](t.message),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function saveFileOrder(n){var t=$(".dataUploadField[data-id='"+n+"'] .nestable").nestable("serialize");$.ajax({url:"/spine-api/data/item/files/update/order",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(t),success:function(n){return toastr[n.messageType](n.message),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function updateDataItem(n){$("#save").attr("disabled",!0);backUpData.item===null&&(backUpData.item={});backUpData.item.pageTitle=$("#pageTitle").length===1?$("#pageTitle").val():backUpData.item.pageTitle===undefined?"":backUpData.item.pageTitle;backUpData.item.pageUrl=$("#pageUrl").length===1?$("#pageUrl").val():backUpData.item.pageUrl===undefined?"":backUpData.item.pageUrl;backUpData.item.pageKeywords=$("#pageKeywords").length===1?$("#pageKeywords").val():backUpData.item.pageKeywords===undefined?"":backUpData.item.pageKeywords;backUpData.item.pageDescription=$("#pageDescription").length===1?$("#pageDescription").val():backUpData.item.pageDescription===undefined?"":backUpData.item.pageDescription;backUpData.item.publishDate=$("#publishDate").length===1&&$("#publishTime").length===1?$("#publishDate").val()+" "+$("#publishTime").val():backUpData.item.publishDate===undefined?new Date:backUpData.item.publishDate;backUpData.item.fromDate=$("#fromDate").length===1&&$("#fromDate").length===1?$("#fromDate").val()+" "+$("#fromTime").val():backUpData.item.fromDate===undefined?new Date:backUpData.item.fromDate;backUpData.item.toDate=$("#toDate").length===1&&$("#toDate").length===1?$("#toDate").val()+" "+$("#toTime").val():backUpData.item.toDate===undefined?new Date:backUpData.item.toDate;backUpData.item.title=$("#title").length===1?$("#title").val():backUpData.item.title===undefined?"":backUpData.item.title;backUpData.item.subtitle=$("#subtitle").length===1?$("#subtitle").val():backUpData.item.subtitle===undefined?"":backUpData.item.subtitle;backUpData.item.text=$("#text").length===1?$("#text").val():backUpData.item.text===undefined?"":backUpData.item.text;backUpData.item.htmlEditor=$("#htmlEditorHolder #html5Editor").length===1?$("#htmlEditorHolder #html5Editor").summernote("code"):backUpData.item.htmlEditor===undefined?"":backUpData.item.htmlEditor;updateBackUpData();backUpData.item.dataTemplateId=dataTemplateId;var t={item:backUpData.item,resources:backUpData.resources};$.ajax({url:"/spine-api/data/item/update",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(t),success:function(t){var i=t.value;return toastr[i.messageType](i.message),dataItemId===0&&(dataItemId=i.item.id,$("#dataTitle").html('Edit item: <span id="displayName">'+i.item.title+"<\/span>").removeClass("hidden")),getDataitem(),$("#rootwizard").bootstrapWizard("show",n),fieldChanged=!1,!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message);$("#save").attr("disabled",!1);fieldChanged=!1}return!0}})}function updateDataItemActive(){var n={Id:dataItemId,Active:activateCheckbox};$.ajax({url:"/spine-api/data/item/active",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(n),success:function(n){var t=n.value,i;return toastr[t.messageType](t.message),i=$("#dataItemActive").prop("checked",activateCheckbox),$.uniform.update(i),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function fillPageDetails(n){if(n.template.detailPage){$("#pageDetails").removeClass("hidden");var t=n.item;$("#pageTitle").val(t!==null?t.pageTitle:"");$("#pageUrl").val(t!==null?t.pageUrl:"");$("#pageKeywords").tagsinput("add",t!==null?t.pageKeywords:"");$("#pageDescription").val(t!==null?t.pageDescription:"");validateDataInformation=$("#wizardForm").validate({ignore:[],errorPlacement:function(n,t){t.parent(".tags-input").length?n.appendTo(t.parent()):t.parent(".input-group").length?n.insertAfter(t.parent()):n.insertAfter(t)},rules:{pageTitle:{required:!0,maxlength:200},pageUrl:{required:!0,maxlength:200},pageKeywords:{maxlength:400},pageDescription:{maxlength:400}},messages:{pageTitle:{required:"Enter a title."},pageUrl:{required:"Enter an url."}},onkeyup:function(n){$(n).valid()}})}}function fillItem(n){var i=n.template,t=n.item,u,r;if(i.titleHeading!==""&&$("#titleHolder").removeClass("hidden").find("input").val(t!==null?t.title:"").parent().find("label").html(i.titleHeading),i.subtitleHeading!==""&&$("#subtitleHolder").removeClass("hidden").find("input").val(t!==null?t.subtitle:"").parent().find("label").html(i.subtitleHeading),i.textHeading!==""&&$("#textHolder").removeClass("hidden").find("textarea").val(t!==null?t.text:"").parent().find("label").html(i.textHeading),i.htmlEditorHeading!==""&&($("#htmlEditorHolder").removeClass("hidden").find("label#htmlEditorHeading").html(i.htmlEditorHeading).parent().find(".note-editor note-frame panel panel-default").remove(),u=$("#htmlEditorHolder #html5Editor").summernote({height:200,toolbar:[["cleaner",["cleaner"]],["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["picture","link","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],cleaner:{notTime:2400,action:"both",newline:"<br>",notStyle:"position:absolute;top:0;left:0;right:0",icon:'<i class="note-icon">Verwijder opmaak<\/i>',keepHtml:!1,keepOnlyTags:["<p>","<br>","<ul>","<li>","<b>","<strong>","<i>","<a>"],keepClasses:!1,badTags:["style","script","applet","embed","noframes","noscript","html","div"],badAttributes:["style","start"]},popover:{image:[["custom",["imageAttributes"]],["imagesize",["imageSize100","imageSize50","imageSize25"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]]],link:[["link",["linkDialogShow","unlink"]]]},lang:"nl-NL",imageAttributes:{imageDialogLayout:"default",icon:'<i class="note-icon-pencil"/>',removeEmpty:!1},displayFields:{imageBasic:!0,imageExtra:!1,linkBasic:!0,linkExtra:!1},callbacks:{onBlur:function(){fieldChanged=!0;$("#save").attr("disabled",!1)},onChange:function(){fieldChanged=!0;$("#save").attr("disabled",!1)},onImageUpload:function(n){var t=new FormData;$.each(n,function(n,i){t.append(i.name,i)});$.ajax({url:"/api/image",type:"post",contentType:!1,processData:!1,data:t,success:function(n){return $.each(n,function(n,t){u.summernote("insertImage",t,function(){})}),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}}}),u.summernote("code",t!==null?t.htmlEditor:""),fieldChanged=!1),i.publishDateHeading!==""){r=getDate(t!==null?new Date(t.publishDate):new Date);$("#publishDateHolder").removeClass("hidden").find("input#publishDate").datepicker({orientation:"top auto",autoclose:!0}).datepicker("update",r).on("input change",function(){$("#save").attr("disabled",!1);fieldChanged=!0});$("#publishDateHolder").find("input#publishTime").timepicker({defaultTime:t!==null?new Date(t.publishDate):new Date});$("#publishDateHolder").find("label").html(i.publishDateHeading)}if(i.fromDateHeading!==""){r=getDate(t!==null?new Date(t.fromDate):new Date);$("#fromDateHolder").removeClass("hidden").find("input#fromDate").datepicker({orientation:"top auto",autoclose:!0}).datepicker("update",r).on("input change",function(){$("#save").attr("disabled",!1);fieldChanged=!0});$("#fromDateHolder").find("input#fromTime").timepicker({defaultTime:t!==null?new Date(t.fromDate):new Date});$("#fromDateHolder").find("label").html(i.fromDateHeading)}if(i.toDateHeading!==""){r=getDate(t!==null?new Date(t.toDate):new Date);$("#toDateHolder").removeClass("hidden").find("input#toDate").datepicker({orientation:"top auto",autoclose:!0}).datepicker("update",r).on("input change",function(){$("#save").attr("disabled",!1);fieldChanged=!0});$("#toDateHolder").find("input#toTime").timepicker({defaultTime:t!==null?new Date(t.toDate):new Date});$("#toDateHolder").find("label").html(i.toDateHeading)}$("#defaultInputs .form-group.hidden").remove();afterCreate(backUpData)}function updateBackUpData(){$("#dataTemplateFields input#input, #dataTemplateFields input#cb, #dataTemplateFields input#rgba, #dataTemplateFields textarea#textarea, #dataTemplateFields #html5Editor, #dataTemplateFields select#select").each(function(){var i,t,n;if($(this).data("changed")){for(i=$(this).parents(".form-group").data("id"),t="",t=$(this).is("input[type='checkbox']")?$(this).is(":checked").toString().toLowerCase():$(this).parents(".form-group").data("type")==="html5editor"?$(this).summernote("code"):$(this).val(),n=0;n<backUpData.resources.length;n++)if(backUpData.resources[n].dataTemplateFieldId===i){backUpData.resources[n].text=t;break}$(this).data("changed",!1)}})}function getDate(n){var t=new Date(n),i=t.getMonth()+1,r=t.getDate();return currentDate=i+"/"+r+"/"+t.getFullYear()}function toCamel(n){var r,i,u,t;if(n instanceof Array){r=[];for(i in n)t=n[i],typeof t=="object"&&(t=toCamel(t)),r.push(t)}else{r={};for(i in n)n.hasOwnProperty(i)&&(u=(i.charAt(0).toLowerCase()+i.slice(1)||i).toString(),t=n[i],(t instanceof Array||t!==null&&t.constructor===Object)&&(t=toCamel(t)),r[u]=t)}return r}var fieldChanged=!1,dataItemId=0,wizardGoTo=0,backUpData,dataItemFileId,activateCheckbox,validateDataInformation;$(document).ready(function(){document.execCommand("defaultParagraphSeparator",!1,"p");dataItemId=$("#dataItemId").val()!==""?$("#dataItemId").val():0;dataTemplateId=$("#dataTemplateId").val();$("#navigation #navData"+dataTemplateId).addClass("active").parents("li").addClass("active").addClass("open").find(".sub-menu").slideDown();getDataitem();$("#create").click(function(){updateDataItem(wizardGoTo);$("#modalCreateAlert").modal("hide")});$("#close").click(function(){fieldChanged=!1;$("#dataTemplateFields input, #dataTemplateFields textarea#textarea, #dataTemplateFields #html5Editor, #dataTemplateFields .summernote-area .note-codable").each(function(){$(this).data("changed",!1)});$("#dataTemplateFields").empty();fillFields(backUpData);$("#modelAlert").modal("hide");$("#rootwizard").bootstrapWizard("show",wizardGoTo)});$("#save").on("click",function(){wizardGoTo=0;var n=$("#wizardForm").valid();if(n){if(fieldChanged){if(dataItemId===0)return $("#modalCreateAlert").modal("show").find(".modal-body").html("Are you sure you want to create this item?").parents("#modalCreateAlert").find("create").html("Add item"),!1;if(dataItemId!==0)return $("#modalCreateAlert").modal("show").find(".modal-body").html("Do you wan't to update your changes?").parents("#modalCreateAlert").find("#create").html("Update"),!1}}else validateDataInformation.focusInvalid()});$("#rootwizard").bootstrapWizard({tabClass:"nav nav-tabs",onTabShow:function(n,t,i){var r=t.find("li").length,u=i+1,f=u/r*100;$("#rootwizard").find(".progress-bar").css({width:f+"%"})},onTabClick:function(n,t,i,r){var u=$("#wizardForm").valid();if(!u)return validateDataInformation.focusInvalid(),!1;wizardGoTo=r;switch(i){case 0:if(fieldChanged){if(dataItemId===0)return $("#modalCreateAlert").modal("show").find(".modal-body").html("Are you sure you want to create this item?").parents("#modalCreateAlert").find("create").html("Add item"),!1;if(dataItemId!==0)return $("#modalCreateAlert").modal("show").find(".modal-body").html("Do you want to update your changes?").parents("#modalCreateAlert").find("#create").html("Update"),!1}return!0}}});$("#rootwizard").bootstrapWizard("disable",1);$("#rootwizard").bootstrapWizard("disable",2);$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){var t=$(n.target).attr("href");t==="#tab3"&&fillUploads(backUpData.uploads)});$("#deleteDataItem").on("click",function(){deleteDataItem()});$("#deleteFile").on("click",function(){deleteFile(dataItemFileId)});$("#saveFileStatus").on("click",function(){saveFileStatus(dataItemFileId)});$("#saveDataItemStatus").click(function(){updateDataItemActive()})});