function fillUploads(n){$.each(n.data,function(n,t){$("#cloneUploadObject").clone().appendTo("#websiteUploads");$("#websiteUploads").find("#cloneUploadObject").removeClass("hidden").attr("id","wu"+t.Id).attr("data-id",t.Id);$("#wu"+t.Id).find("h4").html(t.Heading);$("#wu"+t.Id).find("#uploader").attr("id","uploader"+t.Id);$(".saveFileOrder").off().on("click",function(){var n=$(this).parents(".websiteUploadField").data("id");saveFileOrder(n)});var i=$("#uploader"+t.Id).off().pluploadQueue({runtimes:"html5,flash,silverlight,html4",url:"/spine-api/website/file/add",chunk_size:t.MaxSize+"mb",rename:!0,dragdrop:!0,multiple_queues:!0,filters:{max_file_size:t.MaxSize,mime_types:[{title:"Files",extensions:t.FileExtensions}]},multipart:!0,multipart_params:{width:t.Width,height:t.Height,autoCrop:!1,WebsiteUploadId:t.Id,WebsiteId:websiteId,WebsiteLanguageId:websiteLanguageId},flash_swf_url:"~/plugins/plupload/js/Moxie.swf",silverlight_xap_url:"~/plugins/plupload/js/Moxie.xap",init:{BeforeUpload:function(n,t){n.settings.multipart_params.filename=t.name},UploadComplete:function(){fillFiles(websiteId,t)},FileUploaded:function(n,t,i){var r=$.parseJSON(i.response);toastr[r.value.messageType](r.value.message)},Error:function(n,t){(t.status===401||t.status===403)&&(toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500))}}});fillFiles(websiteId,t)});$("#main-wrapper").fadeIn(500)}function fillFiles(n,t){var i={WebsiteLanguageId:websiteLanguageId,WebsiteUploadId:t.Id};$.ajax({url:"/spine-api/website/files",dataType:"json",type:"get",data:i,success:function(i){var r=i.value;$("#wu"+t.Id+" .nestable ol").html("");$.each(r.data,function(i,r){var u;$("#cloneListObject").clone().appendTo("#wu"+r.WebsiteUploadId+" .nestable ol");$("#wu"+r.WebsiteUploadId+" .nestable").find("#cloneListObject").removeClass("hidden").attr("id","wf"+r.Id).attr("data-id",r.Id);u=r.OriginalPath.substr(r.OriginalPath.lastIndexOf(".")+1).toLowerCase();console.log(u);switch(u){case"jpg":case"jpeg":case"png":case"gif":$("#wf"+r.Id).find("img").removeClass("hidden").attr("src",r.CompressedPath+"?lastmod="+new Date);$("#wf"+r.Id+" .image-crop img").attr("src",r.OriginalPath);$("#wf"+r.Id).find("#video").remove();$("#wf"+r.Id).find("#pdf").remove();u!=="png"&&($("#wf"+r.Id).find(".image-crop").addClass("image-crop-bg-black"),$("#wf"+r.Id).find(".img-preview").css("background-color","#000000"));u!=="jpg"&&$("#wf"+r.Id).find(".image-quality").addClass("hidden");$("#wf"+r.Id).find("#qualitySlider").change(function(){$("#wf"+r.Id).find("#quality").html("("+$(this).val()+")")});var f=$("#wf"+r.Id+" .image-crop > img"),e=t.Width,o=t.Height;$("#wf"+r.Id+" #openCropMdl").on("click",function(){$("#wf"+r.Id+" #imageCropMdl").modal("show");setTimeout(function(){f.cropper({aspectRatio:e/o,preview:"#wf"+r.Id+" .img-preview"})},400)});$("#wf"+r.Id+" #openCropMdl").on("hidden.bs.modal",function(){f.cropper("destroy")});$("#wf"+r.Id+" #crop").on("click",function(){$(".modal").modal("hide")&&f.cropper("getCroppedCanvas").toBlob(function(i){var u=new FormData;u.append("id",r.Id);u.append("type","website");u.append("croppedImage",i);u.append("quality",$("#wf"+r.Id).find("#qualitySlider").val());$.ajax("/spine-api/image/crop",{method:"POST",data:u,processData:!1,contentType:!1,success:function(i){var r=i.value;toastr[r.messageType](r.message);fillFiles(n,t)},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}}})})});break;case"mp4":case"ogv":case"webm":u==="ogv"&&(u="ogg");$("#wf"+r.Id).find("#video").removeClass("hidden").find("source").attr("src",r.OriginalPath+"?lastmod="+new Date).attr("type","video/"+u);$("#wf"+r.Id).find("img").remove();$("#wf"+r.Id).find("#cropHolder").remove();$("#wf"+r.Id).find("#imageCropMdl").remove();$("#wf"+r.Id).find("#pdf").remove();break;case"pdf":$("#wf"+r.Id).find("#pdf").removeClass("hidden").find("a").attr("href",r.OriginalPath);$("#wf"+r.Id).find("img").remove();$("#wf"+r.Id).find("#cropHolder").remove();$("#wf"+r.Id).find("#imageCropMdl").remove();$("#wf"+r.Id).find("#video").remove();break;default:console.log("who knows")}$("#wf"+r.Id).find("#checkbox").find("input").prop("checked",r.Active).uniform();$("#wf"+r.Id).find("#alt").val(r.Alt)});$("#wu"+t.Id+" .nestable").nestable({dragClass:"dd-dragel website-image-dd-item",maxDepth:1});$(".active").off().on("click",function(){$(this).prop("checked",!$(this).prop("checked"));$("#modalStatusAlert").modal("show");websiteFileId=$(this).parents(".dd-item").attr("data-id");activateCheckbox=$(this).prop("checked")===!0?!1:!0});$(".saveAlt").off().on("click",function(){pageFileId=$(this).parents("li").data("id");var n=$(this).parents("li").find("input#alt").val();saveFileAlt(pageFileId,n)});$(".openDeleteFileModal").off().on("click",function(){websiteFileId=$(this).parents("li").data("id");$("#modalDeleteFileAlert").modal("show")});return r.data.length>1&&$("#wu"+t.Id+" .saveFileOrder").removeClass("hidden"),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function deleteFile(n){data={Id:n};$.ajax({url:"/spine-api/website/file/delete",dataType:"json",type:"post",data:data,success:function(t){var r=t.value,i;return toastr[r.messageType](r.message),$("#modalDeleteFileAlert").modal("hide"),i=$(".nestable li[data-id='"+n+"']").parents(".websiteUploadField").data("id"),$(".nestable li[data-id='"+n+"']").remove(),$("#wu"+i+" ol > li").length<2&&$("#wu"+i).find(".saveFileOrder").addClass("hidden"),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function saveFileStatus(n){var t={id:n,active:activateCheckbox};$.ajax({url:"/spine-api/website/file/active",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(t),success:function(t){var i=t.value,r;return toastr[i.messageType](i.message),r=$("#wf"+n).find("#active").prop("checked",activateCheckbox),$.uniform.update(r),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}});$("#modalStatusAlert").modal("hide")}function saveFileAlt(n,t){var i={id:n,alt:t};$.ajax({url:"/spine-api/website/file/alt",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(i),success:function(n){var t=n.value;return toastr[t.messageType](t.message),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}function saveFileOrder(n){var t=$(".websiteUploadField[data-id='"+n+"'] .nestable").nestable("serialize");$.ajax({url:"/spine-api/website/files/update",dataType:"json",type:"post",contentType:"application/json;",data:JSON.stringify(t),success:function(n){var t=n.value;return toastr[t.messageType](t.message),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}})}var websiteId=$("#websiteId").val(),websiteLanguageId=$("#websiteLanguageId").val(),websiteFileId,activateCheckbox;$(document).ready(function(){$("#navigation #navResources").addClass("active");var n={WebsiteId:websiteId};$.ajax({url:"/spine-api/website/uploads",dataType:"json",type:"get",data:n,contentType:"application/json;",success:function(n){var t=n.value;return fillUploads(t),t.resources||$("#websiteBtns").remove(),!0},error:function(n){if(n.status===401||n.status===403)toastr.warning("You are unauthorized to do this. You will be redirected to the login screen."),setTimeout(function(){location.href="/"},4500);else{var t=n.responseJSON.value;toastr[t.messageType](t.message)}return!0}});$("#deleteFile").on("click",function(){deleteFile(websiteFileId)});$("#saveFileStatus").on("click",function(){saveFileStatus(websiteFileId)})});